# 第六題

### 1. XSS 攻擊的基本介紹。

跨站指令碼攻擊，Cross-site scripting 的縮寫是 CSS，但因為 CSS 在網頁設計領域已經被廣泛指層疊樣式表（Cascading Style Sheets），所以將 Cross 改以發音相近的 X 做為縮寫，簡稱 XSS，或被稱為跨站腳本、跨站腳本攻擊。
<br />
<br />
在網路上，惡意駭客善於利用人們的信賴，嘗試於正常網站插入惡意程式碼，故意讓一般使用者在不知情的狀況下，點選該連結，甚至無須點選即自動連線執行，進而竊取使用者資料。這種攻擊方式，為網站應用程序的安全漏洞攻擊，是代碼注入的一種漏洞。
<br />
<br />
駭客最常利用的網頁功能，包括拍賣網站、貼圖網站、新聞評論及 blog 的留言版。主要原因包括這些網頁具備高人氣特性，匯集眾多人潮，並且允許使用者輸入意見交流。為了提高使用者意願，鼓勵參與討論，這些留言版通常僅象徵性利用圖形辨識方法，進行簡單驗證，或者允許新註冊使用者流言，有的甚至完全不做身份驗證。如此一來，有心人士就可以在留言版大作手腳，傷害隨後造訪瀏覽的無辜使用者。
<br />
<br />
XSS 漏洞可以追溯到 1990 年代。大量的網站曾遭受 XSS 漏洞攻擊或被發現此類漏洞，如 Twitter，Facebook，MySpace，Orkut，新浪微博[和百度貼吧。研究表明，最近幾年 XSS 已經超過緩衝區溢出成為最流行的攻擊方式，有 68%的網站可能遭受此類攻擊。根據開放網頁應用安全計劃（Open Web Application Security Project）公佈的 2010 年統計數據，在 Web 安全威脅前 10 位中，XSS 排名第 2，僅次於代碼注入（Injection）。
<br />

> 相關關鍵字：

#### Cross-site scripting, XSS, 安全漏洞攻擊, 代碼注入, Web 安全威脅

> 參考資源：

- [網站程式安全寫作(二)─Cross Site Scripting(XSS)及安全寫作建議](https://www.cc.ntu.edu.tw/chinese/epaper/home/News_Content_n_103858_s_60079.html)

- [XSS 攻擊](http://www.powenko.com/wordpress/xss攻擊/)

- [淺談 XSS 攻擊與防禦的各個環節](https://tech-blog.cymetrics.io/posts/huli/xss-attack-and-defense/)

- [網站防範 XSS 攻擊的關鍵思考](https://www.ithome.com.tw/voice/66888)

<hr >

### 2. 實際設計一個 XSS 攻擊情境。

假設留言版被駭客輸入了以下程式碼：

```html
<iframe
  src="javascript:document.location.href='http://www.nccu.edu.tw';"
></iframe>
```

那麼使用者一旦瀏覽網站，就會自動在網頁的某個區塊中，看到政治大學首頁。假設當初填寫資料的人只是出於惡作劇心理，或者是商業廣告宣傳手法，那麼一般使用者除了被騷擾以及佔用無謂時間外，至少沒有受到任何實質傷害。但如果 http://www.nccu.edu.tw 網址被更改成其他惡意網站的程式，那麼瀏覽網站的使用者，都會在不知情的狀況下，自動執行此惡意程式。若使用者電腦中的防毒軟體沒有有效發揮攔阻功效，就可能導致系統中毒，或是被植入後門程式。讓電腦病毒直接入侵使用者電腦，利用繞過電腦正常存取管道的手法，將惡性程式植入受害者的電腦系統以竊取重要資料，或是惡意破壞。

<hr >

### 3. 根據上述設計的情境，說明開發者該如何預防。

**使用加密連線傳輸資料**<br />
透過 https（SSL、TLS）加密連線方式，確保所有傳輸內容不會遭到駭客惡意攔截、竊聽甚至竄改，達到安全基本要求 CIA 規範中的 Confidentiality 與 Integrity，可以有效減少 man-in-the-middle attack、session hijack 或 session re-play attack 發生的可能性。雖然這種防護措施看起來與程式寫作無關，但開發者在網站建置的第一步，向系統管理人員提出要求，確認伺服器支援 https 加密連線，以確保網站未來的營運安全，依然是相當重要的過程。
<br />

**最低權限（least privilege）政策**<br />
只要是上線運作，提供服務的系統，無論採用何等銅牆鐵壁般的嚴密防護，終究難以避免遭受惡意人士的嘗試滋擾。當網站不慎遭受入侵成功時，如何有效降低傷害，做好損壞控管，災害隔離，這才是檢驗系統是否有事前規劃資訊安全防護的最佳實證。最常被廣為運用的策略，就是最低權限政策。利用低權限帳號執行某些工作，可保障一旦出問題時，不至於影響其他帳號、其他工作，甚至網站本身以及作業系統之運作。可以參考以下幾個具體的作法：
<br />

- 使用個別的獨立帳號，例如：www 或 nobody，執行 http daemon。絕對避免使用 root 身份執行。未來若遭惡意執行程式，其執行身份也將是該獨立帳號。因此損害範圍可侷限在該帳號之管轄區域，例如網站本身目錄。至少不至於讀取系統機密檔案，或者覆蓋任何重要檔案。而且，對一個大型組織來說，通常 root 身份的權限是不會被隨意分享或共用的。
- 設定網站程式目錄及檔案的擁有者（例如：root、user1）不同於上述網站程式的執行帳號（例如：www、nobody）。如此即便發生入侵事件，由於駭客取得的身份為網站程式的執行帳號，因而無法竄改或覆蓋網站程式，至多僅能利用讀取方式竊取資料，如此可有效降低網站受害程度。
- 嚴格設定 database 帳號權限。如果沒有修改資料必要，僅允許 SELECT 權限。並且檢討給予 DELETE 權限之必要性。尤其絕對不能以系統管理者身份（例如 MSSQL 之 sa）連接資料庫，以避免遭受 SQL Injection 或其他入侵攻擊時，損害程度一發不可收拾。
  <br />

**資料庫端之安全設計**<br />

- 規劃 table schema，依照資料特性分配不同 table，並分別定義存取權限。未來僅允許網站程式寫入某幾個 table，例如：使用記錄與購物列表，以降低資料遭誤寫或竄改之威脅。
<br />
- 避免以 DELETE 方式修改資料。例如當顧客想要取消某一筆訂單時，建議採用 INSERT 一筆取消訂單方式為之。當顧客想要修改一筆訂單時，建議採用 INSERT 一筆取消訂單，然後再 INSERT 一筆新訂單方式處理。若上述方式有執行困難，再考慮以 UPDATE 註記某欄位方式進行，但務必以其他方式留下記錄，以利追查。在資料庫端所給予之存取權限，可以嚴格侷限於 INSERT 或 UPDATE。這樣不但方便未來查詢顧客更改歷程，也可以有效避免 table 遭到不慎或惡意清除之威脅。
<br />
- 以 store procedure 方式存取 table，取代直接執行 SQL 指令。通常有許多重要且敏感的 table 是無可避免必須接受更新，例如顧客的購物清單。比較安全的建議作法是，預先設計資料讀取及更新的 store procedure，未來網站程式需要讀取或更新 table 時，直接呼叫 store procedure，而不是以 SQL 指令進行 INSERT、SELECT。只要 store procedure 之設計足夠嚴謹，將可有效防護 table 之安全性，提升資料正確性，降低風險。
<br />
- 如果是 MS SQL 產品，除非必要，否則請務必關閉所有延伸預存程序（extended stored procedures）支援，以避免遭惡意攻擊。根據經驗，對於一般網站來說，這些功能幾乎鮮少被使用，若沿用預設啟動的設定，只會無端增加系統安全風險，得不償失。
<br />

**利用 Server side 之 Session 功能傳遞參數**<br />
- 藉由先前所描述之安全漏洞可以得知，許多問題的根源都是來自不安全的參數傳遞方式，其中尤以 GET 為最多。
<br />
- 然而目前成熟的網頁程式環境，包括：ASP.NET 與 PHP、Java 等，都已經提供 server side 的 session 功能。由 server side 統一進行 session 建立、檢查、刪除等維護工作，都可以有效降低人為疏失造成的安全漏洞，並且大幅簡化程式設計人員的負擔。未來在程式開發時，只要盡量將頁面之間的變數傳遞改用 session 方式，即可免於參數遭使用者惡意竄改之威脅。舉例來說，使用者通過帳號密碼驗證後，即可將使用者名稱存放於 server side 的 session variable 中，未來如果需要進行成績查詢、地址更改等功能，對應的 query.php 及 address.php 程式可以直接從 session variable 中取得使用者名稱，而不必再利用 GET、POST 等方式傳遞資料，杜絕因為參數遭竄改所引發之安全漏洞。
<br />
